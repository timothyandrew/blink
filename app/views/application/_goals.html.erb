<ul class="student_goals list-group">
  <h4><%= link_to goal_name_for_depth(depth).pluralize, new_student_goal_path(@student, parent_id: parent_id) %></h4>

  <% if goals.present? %>
    <% goals.each_with_index do |goal, index| %>
      <li class="student_goal list-group-item <%= (depth % 2 == 0) ? "odd" : "even" %>">

        <div>
          <h3 class="goal-tree-goal-title">
            <a class="disclosure glyphicon glyphicon-triangle-bottom" data-toggle="collapse" href=<%= "#goal-body-#{goal.id}" %>></a>
            <%= link_to "#{index + 1}. #{goal.title}", student_goal_path(@student, goal), class: 'goal-name' %>
          </h3>
          <span class="goal-date"><%= goal.date_range %></span>
        </div>


        <div class="collapse in goal-body" id=<%= "goal-body-#{goal.id}" %>>
          <p><%= goal.description %></p>

          <% if depth < 4 %>
            <%= render partial: "goals", locals: { goals: goal.children.decorate, depth: depth.next, parent_id: goal.id } %>
          <% end %>
        </div>

        <script type="text/javascript">
         $("<%= "#goal-body-#{goal.id}" %>").on("shown.bs.collapse", function(event) {
           $("<%= ".disclosure[href='#goal-body-#{goal.id}']".html_safe %>").removeClass("glyphicon-triangle-right");
           $("<%= ".disclosure[href='#goal-body-#{goal.id}']".html_safe %>").addClass("glyphicon-triangle-bottom");
           event.stopPropagation();
         });

         $("<%= "#goal-body-#{goal.id}" %>").on("hidden.bs.collapse", function(event) {
           $("<%= ".disclosure[href='#goal-body-#{goal.id}']".html_safe %>").removeClass("glyphicon-triangle-bottom");
           $("<%= ".disclosure[href='#goal-body-#{goal.id}']".html_safe %>").addClass("glyphicon-triangle-right");
           event.stopPropagation();
         });
        </script>


      </li>
    <% end %>

  <% end %>
</ul>
